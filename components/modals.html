<!-- Modal Components for Mazzaro Milano HR System -->
<!-- This component contains reusable modal templates for the HR system -->

<!-- Basic Modal Structure -->
<div class="modal-overlay" id="basicModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Titre du modal</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Modal content goes here -->
            <p>Contenu du modal...</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light modal-cancel">Annuler</button>
            <button class="btn btn-primary modal-confirm">Confirmer</button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirmationModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Confirmation</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="confirmation-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <p class="confirmation-message">Êtes-vous sûr de vouloir effectuer cette action ?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light modal-cancel">Annuler</button>
            <button class="btn btn-primary modal-confirm">Confirmer</button>
        </div>
    </div>
</div>

<!-- Alert Modal -->
<div class="modal-overlay" id="alertModal">
    <div class="modal">
        <div class="modal-header alert">
            <h3 class="modal-title">Alerte</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="alert-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <p class="alert-message">Message d'alerte important.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary modal-ok">OK</button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal-overlay" id="successModal">
    <div class="modal">
        <div class="modal-header success">
            <h3 class="modal-title">Succès</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <p class="success-message">L'opération a été effectuée avec succès.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success modal-ok">OK</button>
        </div>
    </div>
</div>

<!-- Form Modal -->
<div class="modal-overlay" id="formModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Formulaire</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="modalForm">
                <!-- Form fields will be dynamically added here -->
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light modal-cancel">Annuler</button>
            <button class="btn btn-primary modal-submit">Soumettre</button>
        </div>
    </div>
</div>

<!-- Task Details Modal -->
<div class="modal-overlay" id="taskDetailsModal">
    <div class="modal" style="max-width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">Détails de la tâche</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="task-details-content">
                <div class="task-detail-header mb-3">
                    <h4 id="taskDetailTitle">Titre de la tâche</h4>
                    <div class="task-detail-meta">
                        <span id="taskDetailId">TASK-2025-001</span>
                        <span id="taskDetailStatus" class="task-status in-progress">En cours</span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Assigné à:</div>
                            <div class="detail-value" id="taskDetailAssignees">
                                <!-- Assignee avatars will be inserted here -->
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Boutique:</div>
                            <div class="detail-value" id="taskDetailStore">Boutique Sud</div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Date de création:</div>
                            <div class="detail-value" id="taskDetailCreatedDate">12/05/2025</div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Date limite:</div>
                            <div class="detail-value" id="taskDetailDueDate">20/05/2025</div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Priorité:</div>
                            <div class="detail-value" id="taskDetailPriority">
                                <span class="badge badge-danger">Haute</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="detail-group">
                            <div class="detail-label">Progression:</div>
                            <div class="detail-value" id="taskDetailProgress">
                                <div class="progress" style="height: 15px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 35%"></div>
                                </div>
                                <span class="progress-text">35%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail-group mb-3">
                    <div class="detail-label">Description:</div>
                    <div class="detail-value" id="taskDetailDescription">
                        Description détaillée de la tâche...
                    </div>
                </div>

                <div class="task-attachments mb-3">
                    <div class="detail-label">Pièces jointes:</div>
                    <div class="detail-value" id="taskDetailAttachments">
                        <!-- Attachments will be inserted here -->
                        <div class="no-attachments">Aucune pièce jointe</div>
                    </div>
                </div>

                <div class="task-comments">
                    <div class="detail-label">Commentaires:</div>
                    <div class="comments-list" id="taskDetailComments">
                        <!-- Comments will be inserted here -->
                        <div class="no-comments">Aucun commentaire</div>
                    </div>

                    <div class="add-comment mt-3">
                        <form id="taskCommentForm">
                            <div class="form-group">
                                <textarea class="form-control" rows="2"
                                    placeholder="Ajouter un commentaire..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-sm btn-primary">
                                <i class="fas fa-paper-plane"></i> Envoyer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light" data-action="print">
                <i class="fas fa-print"></i> Imprimer
            </button>
            <button class="btn btn-primary" data-action="edit">
                <i class="fas fa-edit"></i> Modifier
            </button>
        </div>
    </div>
</div>

<!-- Employee Evaluation Modal -->
<div class="modal-overlay" id="evaluationModal">
    <div class="modal" style="max-width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">Évaluation de l'employé</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="employee-eval-header">
                <div class="employee-avatar">
                    <img src="../assets/img/avatars/default.jpg" alt="Employee" id="evalEmployeeAvatar">
                </div>
                <div class="employee-info">
                    <h4 id="evalEmployeeName">Nom de l'employé</h4>
                    <p id="evalEmployeePosition">Poste - Boutique</p>
                </div>
            </div>

            <form id="evaluationForm">
                <div class="form-group">
                    <label class="form-label">Période d'évaluation</label>
                    <div class="d-flex gap-2">
                        <select class="form-control" id="evalPeriod">
                            <option value="q1-2025">Q1 2025 (Jan-Mar)</option>
                            <option value="q2-2025" selected>Q2 2025 (Avr-Jun)</option>
                            <option value="q3-2025">Q3 2025 (Jul-Sep)</option>
                            <option value="q4-2025">Q4 2025 (Oct-Déc)</option>
                        </select>
                    </div>
                </div>

                <div class="evaluation-criteria mt-4">
                    <h5>Critères d'évaluation</h5>

                    <div class="criteria-item">
                        <div class="criteria-header">
                            <label class="form-label">Service client</label>
                            <div class="rating-value">4.0/5</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-value="1"></i>
                            <i class="fas fa-star" data-value="2"></i>
                            <i class="fas fa-star" data-value="3"></i>
                            <i class="fas fa-star" data-value="4"></i>
                            <i class="far fa-star" data-value="5"></i>
                        </div>
                    </div>

                    <div class="criteria-item mt-3">
                        <div class="criteria-header">
                            <label class="form-label">Connaissances des produits</label>
                            <div class="rating-value">3.0/5</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-value="1"></i>
                            <i class="fas fa-star" data-value="2"></i>
                            <i class="fas fa-star" data-value="3"></i>
                            <i class="far fa-star" data-value="4"></i>
                            <i class="far fa-star" data-value="5"></i>
                        </div>
                    </div>

                    <div class="criteria-item mt-3">
                        <div class="criteria-header">
                            <label class="form-label">Objectifs de vente</label>
                            <div class="rating-value">3.5/5</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-value="1"></i>
                            <i class="fas fa-star" data-value="2"></i>
                            <i class="fas fa-star" data-value="3"></i>
                            <i class="fas fa-star-half-alt" data-value="4"></i>
                            <i class="far fa-star" data-value="5"></i>
                        </div>
                    </div>

                    <div class="criteria-item mt-3">
                        <div class="criteria-header">
                            <label class="form-label">Travail d'équipe</label>
                            <div class="rating-value">4.5/5</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-value="1"></i>
                            <i class="fas fa-star" data-value="2"></i>
                            <i class="fas fa-star" data-value="3"></i>
                            <i class="fas fa-star" data-value="4"></i>
                            <i class="fas fa-star-half-alt" data-value="5"></i>
                        </div>
                    </div>

                    <div class="criteria-item mt-3">
                        <div class="criteria-header">
                            <label class="form-label">Ponctualité</label>
                            <div class="rating-value">5.0/5</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star" data-value="1"></i>
                            <i class="fas fa-star" data-value="2"></i>
                            <i class="fas fa-star" data-value="3"></i>
                            <i class="fas fa-star" data-value="4"></i>
                            <i class="fas fa-star" data-value="5"></i>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-4">
                    <label for="evalComments" class="form-label">Commentaires et suggestions</label>
                    <textarea id="evalComments" class="form-control" rows="4"
                        placeholder="Saisissez vos commentaires et suggestions pour l'employé..."></textarea>
                </div>

                <div class="form-group mt-3">
                    <label for="evalObjectives" class="form-label">Objectifs pour la prochaine période</label>
                    <textarea id="evalObjectives" class="form-control" rows="3"
                        placeholder="Définissez les objectifs pour la prochaine période..."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light modal-cancel">Annuler</button>
            <button class="btn btn-primary modal-submit">Soumettre l'évaluation</button>
        </div>
    </div>
</div>

<!-- Leave Request Modal -->
<div class="modal-overlay" id="leaveRequestModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Demande de congé</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="leaveRequestForm">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label for="leave-type" class="form-label">Type de congé</label>
                            <select id="leave-type" class="form-control">
                                <option value="annual">Congé annuel</option>
                                <option value="sick">Congé maladie</option>
                                <option value="personal">Congé personnel</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label for="leave-start-date" class="form-label">Date de début</label>
                            <input type="date" id="leave-start-date" class="form-control">
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group">
                            <label for="leave-end-date" class="form-label">Date de fin</label>
                            <input type="date" id="leave-end-date" class="form-control">
                        </div>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="half-day">
                        <label class="custom-control-label" for="half-day">Demi-journée</label>
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label for="leave-reason" class="form-label">Motif du congé</label>
                    <textarea id="leave-reason" class="form-control" rows="3"
                        placeholder="Veuillez préciser le motif de votre demande de congé..."></textarea>
                </div>

                <div class="form-group">
                    <label for="leave-contact" class="form-label">Contact en cas d'urgence (optionnel)</label>
                    <input type="text" id="leave-contact" class="form-control"
                        placeholder="Numéro de téléphone ou email...">
                </div>

                <div class="form-group">
                    <div id="days-calculation" class="alert alert-info mt-3" style="display: none;">
                        Nombre de jours ouvrables : <span id="workdays-count">0</span>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-light modal-cancel">Annuler</button>
            <button class="btn btn-primary modal-submit">Soumettre la demande</button>
        </div>
    </div>
</div>

<!-- JavaScript for Modal Functionality -->
<script>
    /**
     * Modal utility functions for Mazzaro Milano HR System
     */
    const ModalUtils = {
        // Show a modal by ID
        show: function (modalId) {
            const modalOverlay = document.getElementById(modalId);
            if (modalOverlay) {
                modalOverlay.classList.add('active');
                // Add modal specific initialization if needed
                if (modalId === 'evaluationModal') {
                    this.initRatingStars();
                }
            }
        },

        // Hide a modal by ID
        hide: function (modalId) {
            const modalOverlay = document.getElementById(modalId);
            if (modalOverlay) {
                modalOverlay.classList.remove('active');
            }
        },

        // Hide all modals
        hideAll: function () {
            const modalOverlays = document.querySelectorAll('.modal-overlay');
            modalOverlays.forEach(overlay => {
                overlay.classList.remove('active');
            });
        },

        // Initialize a confirmation modal
        confirm: function (message, onConfirm, onCancel) {
            const modal = document.getElementById('confirmationModal');
            const messageElement = modal.querySelector('.confirmation-message');
            const confirmButton = modal.querySelector('.modal-confirm');
            const cancelButton = modal.querySelector('.modal-cancel');
            const closeButton = modal.querySelector('.modal-close');

            // Set message
            messageElement.textContent = message;

            // Remove existing event listeners
            const newConfirmButton = confirmButton.cloneNode(true);
            const newCancelButton = cancelButton.cloneNode(true);
            const newCloseButton = closeButton.cloneNode(true);

            confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
            cancelButton.parentNode.replaceChild(newCancelButton, cancelButton);
            closeButton.parentNode.replaceChild(newCloseButton, closeButton);

            // Add new event listeners
            newConfirmButton.addEventListener('click', () => {
                this.hide('confirmationModal');
                if (typeof onConfirm === 'function') onConfirm();
            });

            newCancelButton.addEventListener('click', () => {
                this.hide('confirmationModal');
                if (typeof onCancel === 'function') onCancel();
            });

            newCloseButton.addEventListener('click', () => {
                this.hide('confirmationModal');
                if (typeof onCancel === 'function') onCancel();
            });

            // Show modal
            this.show('confirmationModal');
        },

        // Show an alert modal
        alert: function (message, onOk) {
            const modal = document.getElementById('alertModal');
            const messageElement = modal.querySelector('.alert-message');
            const okButton = modal.querySelector('.modal-ok');
            const closeButton = modal.querySelector('.modal-close');

            // Set message
            messageElement.textContent = message;

            // Remove existing event listeners
            const newOkButton = okButton.cloneNode(true);
            const newCloseButton = closeButton.cloneNode(true);

            okButton.parentNode.replaceChild(newOkButton, okButton);
            closeButton.parentNode.replaceChild(newCloseButton, closeButton);

            // Add new event listeners
            newOkButton.addEventListener('click', () => {
                this.hide('alertModal');
                if (typeof onOk === 'function') onOk();
            });

            newCloseButton.addEventListener('click', () => {
                this.hide('alertModal');
                if (typeof onOk === 'function') onOk();
            });

            // Show modal
            this.show('alertModal');
        },

        // Show a success modal
        success: function (message, onOk) {
            const modal = document.getElementById('successModal');
            const messageElement = modal.querySelector('.success-message');
            const okButton = modal.querySelector('.modal-ok');
            const closeButton = modal.querySelector('.modal-close');

            // Set message
            messageElement.textContent = message;

            // Remove existing event listeners
            const newOkButton = okButton.cloneNode(true);
            const newCloseButton = closeButton.cloneNode(true);

            okButton.parentNode.replaceChild(newOkButton, okButton);
            closeButton.parentNode.replaceChild(newCloseButton, closeButton);

            // Add new event listeners
            newOkButton.addEventListener('click', () => {
                this.hide('successModal');
                if (typeof onOk === 'function') onOk();
            });

            newCloseButton.addEventListener('click', () => {
                this.hide('successModal');
                if (typeof onOk === 'function') onOk();
            });

            // Show modal
            this.show('successModal');
        },

        // Initialize a form modal
        initForm: function (title, fields, onSubmit) {
            const modal = document.getElementById('formModal');
            const titleElement = modal.querySelector('.modal-title');
            const formElement = modal.querySelector('#modalForm');
            const submitButton = modal.querySelector('.modal-submit');
            const cancelButton = modal.querySelector('.modal-cancel');
            const closeButton = modal.querySelector('.modal-close');

            // Set title
            titleElement.textContent = title;

            // Clear existing form fields
            formElement.innerHTML = '';

            // Add new form fields
            fields.forEach(field => {
                const fieldHtml = this.createFormField(field);
                formElement.innerHTML += fieldHtml;
            });

            // Remove existing event listeners
            const newSubmitButton = submitButton.cloneNode(true);
            const newCancelButton = cancelButton.cloneNode(true);
            const newCloseButton = closeButton.cloneNode(true);

            submitButton.parentNode.replaceChild(newSubmitButton, submitButton);
            cancelButton.parentNode.replaceChild(newCancelButton, cancelButton);
            closeButton.parentNode.replaceChild(newCloseButton, closeButton);

            // Add new event listeners
            newSubmitButton.addEventListener('click', () => {
                const formData = this.getFormData(formElement);
                if (typeof onSubmit === 'function') onSubmit(formData);
                this.hide('formModal');
            });

            newCancelButton.addEventListener('click', () => {
                this.hide('formModal');
            });

            newCloseButton.addEventListener('click', () => {
                this.hide('formModal');
            });

            // Show modal
            this.show('formModal');
        },

        // Create a form field HTML
        createFormField: function (field) {
            let html = '';

            switch (field.type) {
                case 'text':
                case 'email':
                case 'number':
                case 'date':
                    html = `
            <div class="form-group">
              <label for="${field.id}" class="form-label">${field.label}</label>
              <input type="${field.type}" id="${field.id}" class="form-control"
                  ${field.value ? `value="${field.value}"` : ''}
                  ${field.placeholder ? `placeholder="${field.placeholder}"` : ''}
                  ${field.required ? 'required' : ''}>
            </div>
          `;
                    break;

                case 'textarea':
                    html = `
            <div class="form-group">
              <label for="${field.id}" class="form-label">${field.label}</label>
              <textarea id="${field.id}" class="form-control" rows="${field.rows || 3}"
                  ${field.placeholder ? `placeholder="${field.placeholder}"` : ''}
                  ${field.required ? 'required' : ''}>${field.value || ''}</textarea>
            </div>
          `;
                    break;

                case 'select':
                    html = `
            <div class="form-group">
              <label for="${field.id}" class="form-label">${field.label}</label>
              <select id="${field.id}" class="form-control" ${field.required ? 'required' : ''}>
                ${field.options.map(option => `
                  <option value="${option.value}" ${option.value === field.value ? 'selected' : ''}>
                    ${option.text}
                  </option>
                `).join('')}
              </select>
            </div>
          `;
                    break;

                case 'checkbox':
                    html = `
            <div class="form-group">
              <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id="${field.id}" ${field.checked ? 'checked' : ''}>
                <label class="custom-control-label" for="${field.id}">${field.label}</label>
              </div>
            </div>
          `;
                    break;

                case 'radio':
                    html = `
            <div class="form-group">
              <label class="form-label">${field.label}</label>
              ${field.options.map((option, index) => `
                <div class="custom-control custom-radio">
                  <input type="radio" class="custom-control-input" id="${field.id}_${index}" 
                      name="${field.id}" value="${option.value}" ${option.value === field.value ? 'checked' : ''}>
                  <label class="custom-control-label" for="${field.id}_${index}">${option.text}</label>
                </div>
              `).join('')}
            </div>
          `;
                    break;

                case 'hidden':
                    html = `<input type="hidden" id="${field.id}" value="${field.value || ''}">`;
                    break;
            }

            return html;
        },

        // Get form data
        getFormData: function (form) {
            const formData = {};
            const elements = form.elements;

            for (let i = 0; i < elements.length; i++) {
                const element = elements[i];
                const id = element.id;

                if (!id) continue;

                if (element.type === 'checkbox') {
                    formData[id] = element.checked;
                } else if (element.type === 'radio') {
                    if (element.checked) {
                        formData[element.name] = element.value;
                    }
                } else {
                    formData[id] = element.value;
                }
            }

            return formData;
        },

        // Initialize rating stars
        initRatingStars: function () {
            const ratingGroups = document.querySelectorAll('.rating-stars');

            ratingGroups.forEach(group => {
                const stars = group.querySelectorAll('i');
                const valueDisplay = group.parentNode.querySelector('.rating-value');

                stars.forEach(star => {
                    star.addEventListener('click', function () {
                        const value = parseFloat(this.getAttribute('data-value'));
                        let newRating = value;

                        // Reset all stars
                        stars.forEach(s => {
                            s.className = s.className.replace('fas', 'far').replace('fa-star-half-alt', 'fa-star');
                        });

                        // Fill stars up to selected value
                        for (let i = 0; i < stars.length; i++) {
                            if (i < Math.floor(value)) {
                                stars[i].className = stars[i].className.replace('far', 'fas');
                            } else if (i === Math.floor(value) && value % 1 !== 0) {
                                stars[i].className = 'fas fa-star-half-alt';
                            }
                        }

                        // Update value display
                        if (valueDisplay) {
                            valueDisplay.textContent = newRating.toFixed(1) + '/5';
                        }
                    });

                    star.addEventListener('mouseover', function () {
                        const value = parseFloat(this.getAttribute('data-value'));

                        // Show preview
                        stars.forEach((s, i) => {
                            if (i < value) {
                                s.style.color = '#ffc107';
                            }
                        });
                    });

                    star.addEventListener('mouseout', function () {
                        // Restore original color
                        stars.forEach(s => {
                            s.style.color = '';
                        });
                    });
                });
            });
        }
    };

    // Initialize modals on document load
    document.addEventListener('DOMContentLoaded', function () {
        // Add close handlers for all modals
        const closeButtons = document.querySelectorAll('.modal-close, .modal-cancel');
        closeButtons.forEach(button => {
            const modalOverlay = button.closest('.modal-overlay');
            button.addEventListener('click', () => {
                modalOverlay.classList.remove('active');
            });
        });

        // Close modals when clicking outside the modal
        const modalOverlays = document.querySelectorAll('.modal-overlay');
        modalOverlays.forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                // Only close if clicked on the overlay itself, not the modal
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // Prevent event propagation for modals
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });

        // Initialize task details modal functionality
        initTaskDetailsModal();

        // Initialize evaluation modal functionality
        initEvaluationModal();

        // Initialize leave request modal functionality
        initLeaveRequestModal();
    });

    // Task Details Modal
    function initTaskDetailsModal() {
        const taskCommentForm = document.querySelector('#taskCommentForm');

        if (taskCommentForm) {
            taskCommentForm.addEventListener('submit', function (e) {
                e.preventDefault();

                const commentText = this.querySelector('textarea').value.trim();
                if (!commentText) return;

                // In a real app, this would save the comment to the server
                // For this prototype, we'll add it to the comments list

                const commentsList = document.querySelector('#taskDetailComments');
                const noComments = commentsList.querySelector('.no-comments');

                if (noComments) {
                    noComments.remove();
                }

                const commentItem = document.createElement('div');
                commentItem.className = 'comment-item';
                commentItem.innerHTML = `
                    <div class="comment-avatar">
                        <img src="../assets/img/avatars/employee.jpg" alt="User">
                    </div>
                    <div class="comment-content">
                        <div class="comment-header">
                            <span class="comment-author">Ahmed Employe</span>
                            <span class="comment-date">À l'instant</span>
                        </div>
                        <div class="comment-text">
                            ${commentText}
                        </div>
                    </div>
                `;

                commentsList.appendChild(commentItem);

                // Clear the textarea
                this.querySelector('textarea').value = '';
            });
        }

        // Handle print action
        const printButton = document.querySelector('#taskDetailsModal [data-action="print"]');
        if (printButton) {
            printButton.addEventListener('click', function () {
                // In a real app, this would open the print dialog
                alert('Fonctionnalité d\'impression à implémenter');
            });
        }

        // Handle edit action
        const editButton = document.querySelector('#taskDetailsModal [data-action="edit"]');
        if (editButton) {
            editButton.addEventListener('click', function () {
                // In a real app, this would open the edit form
                alert('Fonctionnalité de modification à implémenter');
            });
        }
    }

    // Evaluation Modal
    function initEvaluationModal() {
        const evaluationForm = document.querySelector('#evaluationForm');

        if (evaluationForm) {
            evaluationForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // In a real app, this would save the evaluation to the server
                // For this prototype, we'll just show a success message

                ModalUtils.success('L\'évaluation a été soumise avec succès.', function () {
                    ModalUtils.hide('evaluationModal');
                });
            });
        }
    }

    // Leave Request Modal
    function initLeaveRequestModal() {
        const leaveStartDate = document.querySelector('#leave-start-date');
        const leaveEndDate = document.querySelector('#leave-end-date');
        const halfDayCheckbox = document.querySelector('#half-day');
        const daysCalculation = document.querySelector('#days-calculation');
        const workdaysCount = document.querySelector('#workdays-count');

        // Set minimum date to today
        const today = new Date();
        const dateString = today.toISOString().split('T')[0];

        if (leaveStartDate) {
            leaveStartDate.min = dateString;

            // Update end date min value when start date changes
            leaveStartDate.addEventListener('change', function () {
                if (leaveEndDate) {
                    leaveEndDate.min = this.value;

                    // If end date is before start date, update it
                    if (leaveEndDate.value && leaveEndDate.value < this.value) {
                        leaveEndDate.value = this.value;
                    }

                    calculateWorkdays();
                }
            });
        }

        if (leaveEndDate) {
            leaveEndDate.min = dateString;

            // Calculate workdays when end date changes
            leaveEndDate.addEventListener('change', function () {
                calculateWorkdays();
            });
        }

        if (halfDayCheckbox) {
            halfDayCheckbox.addEventListener('change', function () {
                calculateWorkdays();
            });
        }

        // Calculate workdays function
        function calculateWorkdays() {
            if (!leaveStartDate || !leaveEndDate || !leaveStartDate.value || !leaveEndDate.value) {
                if (daysCalculation) {
                    daysCalculation.style.display = 'none';
                }
                return;
            }

            const start = new Date(leaveStartDate.value);
            const end = new Date(leaveEndDate.value);
            let days = 0;

            // Count workdays (Monday to Friday)
            const current = new Date(start);
            while (current <= end) {
                const dayOfWeek = current.getDay(); // 0 = Sunday, 6 = Saturday
                if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                    days++;
                }
                current.setDate(current.getDate() + 1);
            }

            // Adjust for half day
            if (halfDayCheckbox && halfDayCheckbox.checked && days > 0) {
                days -= 0.5;
            }

            // Display result
            if (daysCalculation && workdaysCount) {
                workdaysCount.textContent = days;
                daysCalculation.style.display = 'block';
            }
        }

        // Form submission
        const leaveRequestForm = document.querySelector('#leaveRequestForm');

        if (leaveRequestForm) {
            leaveRequestForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Basic validation
                if (!leaveStartDate.value || !leaveEndDate.value) {
                    ModalUtils.alert('Veuillez sélectionner les dates de début et de fin.');
                    return;
                }

                const leaveReason = document.querySelector('#leave-reason');
                if (leaveReason && !leaveReason.value.trim()) {
                    ModalUtils.alert('Veuillez préciser le motif de votre demande de congé.');
                    return;
                }

                // In a real app, this would save the leave request to the server
                // For this prototype, we'll just show a success message

                ModalUtils.success('Votre demande de congé a été soumise avec succès.', function () {
                    ModalUtils.hide('leaveRequestModal');
                    // Reset form
                    leaveRequestForm.reset();
                    if (daysCalculation) {
                        daysCalculation.style.display = 'none';
                    }
                });
            });
        }
    }

    // Export the ModalUtils object to make it available globally
    window.ModalUtils = ModalUtils;
</script>

<!-- CSS for Modals -->
<style>
    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .modal-overlay.active {
        opacity: a;
        visibility: visible;
    }

    .modal {
        background-color: var(--white);
        border-radius: var(--border-radius-lg);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal {
        transform: translateY(0);
    }

    .modal-header {
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--light-gray);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .modal-header.alert {
        background-color: rgba(220, 53, 69, 0.1);
    }

    .modal-header.success {
        background-color: rgba(40, 167, 69, 0.1);
    }

    .modal-title {
        font-weight: 600;
        color: var(--primary-color);
        margin: 0;
    }

    .modal-close {
        background: none;
        border: none;
        color: var(--medium-gray);
        font-size: 1.5rem;
        cursor: pointer;
        transition: color 0.2s ease;
    }

    .modal-close:hover {
        color: var(--secondary-color);
    }

    .modal-body {
        padding: var(--spacing-lg);
    }

    .modal-footer {
        padding: var(--spacing-md) var(--spacing-lg);
        border-top: 1px solid var(--light-gray);
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-md);
    }

    /* Confirmation Modal */
    .confirmation-icon {
        text-align: center;
        font-size: 3rem;
        color: var(--warning-color);
        margin-bottom: var(--spacing-md);
    }

    .confirmation-message {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: var(--spacing-md);
    }

    /* Alert Modal */
    .alert-icon {
        text-align: center;
        font-size: 3rem;
        color: var(--danger-color);
        margin-bottom: var(--spacing-md);
    }

    .alert-message {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: var(--spacing-md);
    }

    /* Success Modal */
    .success-icon {
        text-align: center;
        font-size: 3rem;
        color: var(--success-color);
        margin-bottom: var(--spacing-md);
    }

    .success-message {
        text-align: center;
        font-size: 1.1rem;
        margin-bottom: var(--spacing-md);
    }

    /* Employee Evaluation Modal */
    .employee-eval-header {
        display: flex;
        align-items: center;
        margin-bottom: var(--spacing-lg);
    }

    .employee-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: var(--spacing-md);
    }

    .employee-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .employee-info h4 {
        margin-bottom: 0;
    }

    .employee-info p {
        color: var(--medium-gray);
        margin-bottom: 0;
    }

    .rating-stars {
        color: #ddd;
        font-size: 1.5rem;
        display: flex;
    }

    .rating-stars i {
        margin-right: 5px;
        cursor: pointer;
    }

    .rating-stars i.fas {
        color: #ffc107;
    }

    .rating-stars i.fas.fa-star-half-alt {
        color: #ffc107;
    }

    /* Task Details Modal */
    .task-detail-header {
        border-bottom: 1px solid var(--light-gray);
        padding-bottom: var(--spacing-md);
    }

    .task-detail-meta {
        display: flex;
        justify-content: space-between;
        color: var(--medium-gray);
        font-size: 0.9rem;
        margin-top: var(--spacing-sm);
    }

    .detail-group {
        margin-bottom: var(--spacing-md);
    }

    .detail-label {
        font-weight: 500;
        color: var(--dark-gray);
        margin-bottom: var(--spacing-xs);
    }

    .detail-value {
        color: var(--medium-gray);
    }

    .comments-list {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: var(--spacing-md);
    }

    .no-comments,
    .no-attachments {
        color: var(--medium-gray);
        font-style: italic;
        padding: var(--spacing-sm) 0;
    }

    .comment-item {
        display: flex;
        padding: var(--spacing-sm) 0;
        border-bottom: 1px solid var(--light-gray);
    }

    .comment-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        margin-right: var(--spacing-md);
    }

    .comment-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .comment-content {
        flex-grow: 1;
    }

    .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--spacing-xs);
    }

    .comment-author {
        font-weight: 500;
        color: var(--dark-gray);
    }

    .comment-date {
        color: var(--medium-gray);
        font-size: 0.8rem;
    }

    .comment-text {
        color: var(--medium-gray);
        font-size: 0.9rem;
    }

    /* Demo Accounts Styling */
    .demo-accounts {
        margin-top: var(--spacing-lg);
        background-color: rgba(59, 89, 152, 0.05);
        padding: var(--spacing-md);
        border-radius: var(--border-radius-md);
    }

    .demo-account-list {
        font-size: 0.9rem;
        color: var(--medium-gray);
    }

    .demo-account-item {
        margin-bottom: var(--spacing-xs);
    }

    .demo-account-item:last-child {
        margin-bottom: 0;
    }

    .demo-role {
        color: var(--primary-color);
        font-weight: 500;
    }
</style>